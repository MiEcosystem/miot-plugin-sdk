# è¿ç§»æ‰‹å†Œ

1. è°ƒæ•´ç›®å½•ç»“æ„ï¼Œæ ¹ç›®å½•å¢åŠ `index.js`å’Œ`index.ios.js`ã€‚

   ```js
   // index.js
   import App from "./Main";
   import { Package } from "miot";
   Package.entry(App);
   
   // index.ios.js
   import "./index.js";
   ```

2. åŸæœ‰çš„`Main/index.ios.js`æ›´åä¸º`Main/index.js`ï¼Œåˆ æ‰å…¶ä¸­æ³¨å†Œappå…¥å£çš„ä¸€è¡Œï¼š`AppRegistry.registerComponent()`ã€‚

3. å®‰è£…æ’ä»¶ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¡†æ¶`package.json`ä¸­æœªåŒ…å«ï¼‰ã€‚æ¯”å¦‚é—¹é’Ÿä½¿ç”¨åˆ°çš„`react-native-swipeout`ã€‚

4. å¼•ç”¨ä¾èµ–å°½é‡ä½¿ç”¨es6çš„`import`ï¼Œè€Œä¸æ˜¯`require`ã€‚

5. RN54åºŸå¼ƒäº†`react-native`ä¸­çš„`Component`ï¼Œæ‰€æœ‰ç»„ä»¶å°†ç»§æ‰¿`react`çš„`Component`ã€‚

   ```js
   // old
   var React = require('react-native');
   var {
     StyleSheet,
     Text,
     DeviceEventEmitter,
     PixelRatio,
   } = React;
   
   // new
   import React from 'react';
   import {
     StyleSheet,
     Text,
     DeviceEventEmitter,
     PixelRatio,
   } from 'react-native';
   ```

6. RN54å°†`PropTypes`ä»`react-native`ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œç‹¬ç«‹æˆ`prop-types`ã€‚

   ```js
   // old
   var propTypes = {
     source: React.PropTypes.object,
     highlightedSource: React.PropTypes.object,
     onPress: React.PropTypes.func,
   };
   
   // new
   import PropTypes from 'prop-types';
   // ...
   var propTypes = {
     source: PropTypes.object,
     highlightedSource: PropTypes.object,
     onPress: PropTypes.func,
   };
   ```

7. `React.createClass`æŠ¥é”™è§£å†³æ–¹æ¡ˆ

   ```js
   // old
   var ImageButton = React.createClass({
     propTypes: propTypes,
     getInitialState: function() {
     },
     getDefaultProps: function() {
     },
     //...
     render: function() {
     },
   })
   
   // new
   // RN54ä¸å†æ”¯æŒä½¿ç”¨createClassåˆ›å»ºç»„ä»¶, æ”¹ä¸ºç»§æ‰¿è‡³React.Component
   // key-valueå½¢å¼æ”¹ä¸ºå£°æ˜è¯­å¥
   export default class ImageButton extends React.Component {
     static propTypes = propTypes;
     static initialState = {
     };
     static defaultProps = {
     };
     //...
     render() {
     }
   }
   ```

8. **åˆ‡æ¢è·¯ç”±æ¡†æ¶ï¼ˆâ—ï¸ï¼‰**

   - æ‰€æœ‰é¡µé¢åˆ é™¤ä¹‹å‰çš„è·¯ç”±ç›¸å…³ä»£ç ï¼š

     ```js
     // old
     class MyComponent extends React.Component {
     	// ...
     }
     
     // ...
     
     var route = {
       title: xxx,
       component: MyComponent,
       navBarStyle: {
         backgroundColor: '#f2f2f2',
       },
     };
     
     module.exports = {
       component: MyComponent,
       route: route,
     }
     
     // new
     export default class MyComponent extends React.Component {
     	// ...
     }
     
     // ...
     
     // æ‘ˆå¼ƒä¹‹å‰çš„è·¯ç”±ç³»ç»Ÿå†™æ³•
     // var route = {
     //  title: xxx,
     //  component: MyComponent,
     //  navBarStyle: {
     //    backgroundColor: '#f2f2f2',
     //  },
     //};
     
     // module.exports = {
     //  component: MyComponent,
     //  route: route,
     // }
     ```

   - åœ¨å…¥å£æ–‡ä»¶`Main/index.js`ä¸­é›†ä¸­ç®¡ç†æ‰€æœ‰çš„é¡µé¢ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ï¼š

     ```js
     // å¯¼èˆªç›¸å…³ç»„ä»¶
     import { createStackNavigator } from 'react-navigation';
     import { TitleBarBlack } from 'miot/ui';
     // å¯¼å…¥æ‰€æœ‰çš„é¡µé¢
     import SceneMain from './SceneMain';
     import MainPage from './MainPage';
     import MHSetting from './MHSetting';
     // ...
     
     const RootStack = createStackNavigator(
       {
         // ...
         SceneMain: SceneMain,
         MainPage: MainPage,
         MHSetting: MHSetting,
         // ...
       },
       {
         initialRouteName: 'MainPage',
         navigationOptions: ({ navigation }) => {
           return {
             header: <TitleBarBlack title={navigation.state.params ? navigation.state.params.title : ''} style={{ backgroundColor: '#fff' }}
               onPressLeft={() => {
                 navigation.goBack();
               }} />,
           };
         },
       }
     );
     ```

   - é¡µé¢è·³è½¬ï¼ŒåŒ…æ‹¬å‚æ•°ä¼ é€’å’Œå‚æ•°è·å–

     ```js
     // old
     this.props.navigator.push({
       // è·³è½¬é¡µé¢
       route,
       // ä¼ å‚ï¼Œåœ¨è·³è½¬é¡µé¢ä¸­å¯é€šè¿‡propsç›´æ¥è®¿é—®ï¼Œå³ï¼šthis.props.key
       passProps: {
         key: value
       },
     });
     
     // new
     this.props.navigation.navigate('ComponentName', {
       key: value
     });
     // åœ¨è·³è½¬é¡µé¢è·å–å‚æ•°
     // method 1
     this.props.navigation.state.params.key
     // method 2
     this.props.navigation.getParam("key");
     ```

   - è¿”å›ä¸Šçº§é¡µé¢

   - ```js
     // old
     this.props.navigator.pop();
     
     // new
     this.props.navigation.goBack();
     ```

   - é€€å‡ºæ’ä»¶

   - ```js
     // old
     MHPluginSDK.closeCurrentPage();
     
     // new
     import { Package } from "miot";
     Package.exit()
     ```

   - é¡µé¢è‡ªå®šä¹‰å¯¼èˆªæ 

     ```js
     // æ‰€æœ‰é¡µé¢é»˜è®¤æ²¿ç”¨index.jsä¸­RootStackå®šä¹‰çš„å¯¼èˆªæ æ ·å¼
     const RootStack = createStackNavigator(
     ...
         navigationOptions: ({ navigation }) => {
           return {
             header:
               <TitleBarBlack
                 title={navigation.state.params ? navigation.state.params.title : ''}
                 style={{ backgroundColor: '#fff' }}
                 onPressLeft={() => { navigation.goBack() }}
               />,
           };
         },
     ...
     );
     
     // è‡ªå®šä¹‰å¯¼èˆªæ æ ·å¼
     export default class AddReminder extends React.Component {
       // è¡¨ç¤ºä¸ä½¿ç”¨é»˜è®¤çš„å¯¼èˆªæ 
       static navigationOptions = ({ navigation }) => {
         return {
           header: null
         };
       };
       
       //...
     
       render() {
         return (
             // è‡ªå®šä¹‰æ ‡é¢˜çš„æ ·å¼å’Œé¢œè‰²ï¼Œå·¦å³æŒ‰é’®çš„æ ·å¼ã€é¢œè‰²ä»¥åŠç»‘å®šäº‹ä»¶
             <TitleBarBlack
               title="newTitle" style={{ backgroundColor: 'red' }}
               onPressLeft={() => { this.props.navigation.goBack() }}
               rightText="save"
               leftText="cancel"
               onPressRight={() => {
                 this._save();
               }}
             />
           //...
         )
       }
     ```

   - ç›‘å¬å¯¼èˆªæ çš„ç”Ÿå‘½å‘¨æœŸ

     ```js
     // old
     // å¯ç›‘å¬'willfocus'å’Œ'didfocus'
     this._didFocusListener = DeviceEventEmitter.addListener('didfocus', ({route}) => {
       console.log(route);
     }
     
     // new
     // å¯ç›‘å¬'willBlur', 'willFocus', 'didFocus', 'didBlur'
     this._didFocusListener = this.props.navigation.addListener('didFocus', payload => {
       console.log(payload);
     }
     ```

   - å¯¼èˆªæ æ›´æ–°æœºåˆ¶

     ```js
       // Eg. change device name
       static navigationOptions = ({ navigation }) => {
         return {
           header:
             <TitleBarBlack
               title={navigation.state["params"] ? navigation.state.params.name : Device.name}
               style={{ backgroundColor: '#fff' }}
               onPressLeft={() => { Package.exit() }}
               onPressRight={() => {
                 navigation.navigate('MHSetting', { 'title': 'è®¾ç½®' });
               }}
             />
         };
       };
     
       // è®¾ç½®ä¸­æ”¹åä¹‹åï¼Œé¦–é¡µtitleåŒæ­¥æ”¹å
       this._deviceNameChangedListener = DeviceEvent.deviceNameChanged.addListener((device) => {
         this.props.navigation.setParams({
           name: device.name
         });
         this.forceUpdate();
       });
     ```

9. ç»„ä»¶ç›¸å…³

  - æ–°æ¡†æ¶è°ƒæ•´äº†`ImageButton`ï¼Œé€‚ç”¨äºä¸¤ä¸ªå¹³å°ã€‚

    ```js
    // old
    var ImageButton = require('../CommonModules/ImageButton');
    
    // new
    import ImageButton from 'miot/ui/ImageButton';
    ```

  - `Image`ä¸å†å…è®¸åµŒå¥—

    ```jsx
    // old
    <Image>
      <Text></Text>
    </Image>
    // old,âœ…
    <Animated.Image>
      <Animated.Text></Animated.Text>
    </Animated.Image>
    
    // new
    <ImageBackground>
      <Text></Text>
    </ImageBackground>
    // not allowed,âŒ
    <Animated.ImageBackground>
      <Animated.Text></Animated.Text>
    </Animated.ImageBackground>
    // alternative solution,ğŸ‘Œ
    <Animated.Image/>
    <Animated.View style={{position:'absolute'}}>
      <Animated.Text></Animated.Text>
    </Animated.View>
    ```

  - `SwitchIOS`åºŸå¼ƒï¼Œ`Switch`è·¨å¹³å°è§£å†³æ–¹æ¡ˆ

    ```jsx
    // old
    <SwitchIOS>
    </SwitchIOS>
    
    // new
    // cross-platform solution
    import { RkSwitch } from 'react-native-ui-kitten';
    <RkSwitch>
    </RkSwitch>
    ```

  - `DatePicker`è·¨å¹³å°è§£å†³æ–¹æ¡ˆ

    ```jsx
    // old
    import {DatePickerIOS} from 'react-native'
    
    <DatePickerIOS
      style={styles.datePicker}
      date={this.state.time}
      mode="time"
      onDateChange={(d) => this.setState({ time: d })}
    />
    
    // new 
    // cross-platformï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹åº“rmc-date-picker
    // å¸¸ç”¨å±æ€§å’Œä¹‹å‰å‡ ä¹ä¸€è‡´ï¼ŒUIä¹Ÿèƒ½æ»¡è¶³è¦æ±‚
    import DatePicker from "rmc-date-picker";goBack
    <DatePicker
      style={styles.datePicker}
      defaultDate={this.state.time}
      mode="time"
      onDateChange={(d) => this.setState({ time: d })}
      use12Hours={true}
      locale={LocalizedStrings}
    />
    ```

  - `Picker`è·¨å¹³å°è§£å†³æ–¹æ¡ˆ

    ```jsx
    // old
    import {Picker} from 'react-native'
    
    <Picker
      selectedValue={this.state.pickerValue}
      style={styles.picker}
      onValueChange={(v) => this._setPickerValue(v)}>
      <Picker.Item label={"1"} value={1} />
      <Picker.Item label={"2"} value={2} />
      <Picker.Item label={"3"} value={3} />
    </Picker>
        
    // new
    // cross-platformï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹åº“rmc-picker
    // Pickerå±æ€§ä¸€è‡´ï¼ŒPicker.Itemæ¢æˆTextå³å¯
    import Picker from "rmc-picker";
    
    <Picker
      selectedValue={this.state.pickerValue}
      style={styles.picker}
      onValueChange={(v) => this._setPickerValue(v)}>
      <Text label={"1"} value={1}>1</Text>
      <Text label={"2"} value={2}>2</Text>
      <Text label={"3"} value={3}>3</Text>
    </Picker>
    ```

  - æç¤ºçš„è·¨å¹³å°è§£å†³æ–¹æ¡ˆ

    ```js
    // old
    MHPluginSDK.showLoadingTips("loading");
    MHPluginSDK.dismissTips();
    MHPluginSDK.showFailTips("fail");
    MHPluginSDK.showFinishTips("finish");
    AlertIOS.alert();
    
    // new
    import {
      LoadingDialog,
      MessageDialog
    } from "miot/ui/MessageDialog";
    
    <LoadingDialog
      title='title'
      message='message'
      onDismiss={() => {}}
      visible={this.state.visible}
    />
    
    <MessageDialog
      title='title'
      message='message'
      cancel='cancel'
      confirm='ok'
      onCancel={() => {}}
      onConfirm={() => {}}
      onDismiss={() => {}}
      visible={this.state.visible}
    />
    ```

10. å›¾ç‰‡ä»¥åŠå…¶ä»–èµ„æºçš„å¼•ç”¨æ–¹å¼

  ```js
  // old
  <Image
  source={{ uri: MHPluginSDK.basePath + imagePath + imageName }}
  style={{ width: x, height: y }}
  />
  <Image 
  style={styles.icon} 
  source={this.props.app.sourceOfImage(imageName)}
  />
  
  // new
  // ä¸å†æä¾›basePth
  // static image
  <Image
  source={require(relativeImagePath + imageName)}
  style={{ width: x, height: y }}
  />
  // dynamic image at local cache for plugin
  <Image
  source={{local: imageName}} //local file name
  style={{ width: x, height: y }}
  />
  <Image
  source={{uri: urlToGetImage}} //remote url for image
  style={{ width: x, height: y }}
  />
  ```

11. å…¶ä»–

    - `TouchableWithoutFeedback`åŒ…å«çš„è§†å›¾åœ¨`Android`ä¸­æ— æ³•å“åº”æ»šåŠ¨æ‰‹åŠ¿
    - `Text`è®¾ç½®å±æ€§`numberOfLines`æ˜¾ç¤ºå¤šè¡Œæ–‡å­—ï¼Œåœ¨`Andorid`å¹³å°å¯èƒ½ä¼šå‡ºæ— æ³•å®Œå…¨æ˜¾ç¤ºçš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸Šå­—ä½“æˆ–è€…åˆ‡æ¢å­—ä½“ã€‚
    - æ—§æ¡†æ¶çš„é¡µé¢ä»¥å±å¹•å·¦ä¸Šè§’ä¸ºèµ·ç‚¹å®šä½ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®`marginTop`ä¸º64ï¼Œæ–°æ¡†æ¶ä»¥å¯¼èˆªæ åº•éƒ¨ä¸ºèµ·ç‚¹å®šä½ï¼Œä¸å†éœ€è¦`marginTop`ã€‚
